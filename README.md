# Tableau_PDF_Export_Automation

Necessary scripts and files to export **SOME_DASHBOARD** as PDFs and upload to SF accounts

# Description of the process
- **dashboards.bat** executes **getpartners.py** 
- **getpartners.py** retrieves all partner districts and counties that have a partner district in the view which powers the dashboard we are trying to export
- **dashboards.bat** logs into Tableau using **tabcmd**
- **dashboards.bat** cycles through all districts in **districts.csv**, counties in **counties.csv**, and all parameters in **viewbyparams.csv** and creates the appropriate PDF
- **dashboards.bat** exports those PDFs to **SOME_DASHBOARDExports_Script** & **SOME_DASHBOARDExports_ScriptCount**
- **dashboards.bat** renames all the PDFs in **SOME_DASHBOARDExports_Script** & **SOME_DASHBOARDExports_ScriptCount** 
- **dashboards.bat** then executes **sf_upload.py**
- **sf_upload.py** connects to Salesforce
- Then for each district in **districts.csv** and county in **counties.csv**, **sf_upload.py** gets the associated PDF and creates it as a file in Salesforce
- **sf_upload.py** then links that file to the appropriate District or County Account
- **sf_upload.py** then checks a box which triggers the generation of a public link for that file for that Account
- **dashboards.bat** then executes **emailnotification.py**
- **emailnotification.py** then sends an email notification along with the districts and counties csv to the indicated email address using Amazon SES
- **dashboards.bat** then executes **delete_files.py** 
- **delete_acctreg.py** deletes all the appropriate pdfs along with the districts and counties csvs

## How to use
- Set a task scheduler task to run this at the desired time

## Notes on each file

### dashboards.bat
- Located in Users/Administrator
- This is the file that needs to be run (using a task scheduler or manually) to execute the whole process
- It contains cmd prompts which utilize **tabcmd** to export PDFs for all districts in **districts.csv** using all parameters in **viewbyparams**.
- It then stores those PDFs in **SOME_DASHBOARDExportsScript** and renames them to something more usable.
- It then executes **sf_upload.py**
- Lastly it executes **emailnotification.py**

### CommandLineUtility
- Located in Users/Administrator
- This is the folder on the Windows machine that houses tabcmd as well as all the other necessary files for this process.

### DistrictDashboardSharing
- Where the necessary files are stored, excluding tabcmd.

### SOME_DASHBOARDExports_Script & SOME_DASHBOARDExports_ScriptCounty
- This is where the PDF exports from tabcmd are stored and renamed.
- This is where **sf_upload.py** grabs the PDFs from.

### emailnotification.py
- This is a python script that utilizes Amazon SES (Simple Email Service) to send an email notification when the entire process has been completed.
- It also sends the districts and counties csv files as attachments for tracking.

### sf_upload.py
- This is a python script that connects to Salesforce and loops through all districts in **districts.csv**; grabbing the associated PDF from **SOME_DASHBOARDExports_Script**, uploading that PDF to Salesforce, and linking that file to the District's Account files.

### viewbyparams.csv
- This is a csv file utilized by **dashboards.bat** to filter the Tableau dashboard using parameters of our choice. After further developing the dashboard and conversations with DPM team, the only parameter is Grade Level.
- Only used by **dashboards.bat** not by **appslaunches.bat**

### delete_files.py
- Py script to delete all the pdfs generated by the process off of the ec2 machine
- It also deletes the districts and counties csv files so they are fresh when the process is executed

### getpartners.py
- Py script to extract all the partner districts and counties with a partner districts from the view powering the dashboards.
- These two csvs are then used as the list of entities we will export and upload for.
- This is so the list is fresh every time the process is executed
